/*    ==Scripting Parameters==

    Source Server Version : SQL Server 2014 (12.0.5207)
    Source Database Engine Edition : Microsoft SQL Server Standard Edition
    Source Database Engine Type : Standalone SQL Server

    Target Server Version : SQL Server 2014
    Target Database Engine Edition : Microsoft SQL Server Standard Edition
    Target Database Engine Type : Standalone SQL Server
*/

USE [Dadosadv_D1]
GO

/****** Object:  View [dbo].[CUSTO_FECHAM_CUSTO_VENDAS_PEDIDO]    Script Date: 02/11/2017 06:27:15 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

CREATE VIEW [dbo].[CUSTO_FECHAM_CUSTO_VENDAS_PEDIDO]
AS

SELECT 'MP_GD' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MP'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'MP_WIP' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MP'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL = '99'
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'MP_TER' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MP'
and B1_AGREGCU = '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all

SELECT 'EB_GD' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'EB'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'EB_WIP' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'EB'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL = '99'
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'EB_TER' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'EB'
and B1_AGREGCU = '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'MX_GD' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MX'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'MX_WIP' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MX'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL = '99'
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'MX_TER' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MX'
and B1_AGREGCU = '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'PI_SEMI' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO in ('PI','PE')
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all

SELECT 'PI_WIP' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO IN ('PI','PE')
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL = '99'
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all



SELECT 'PI_TER' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO in ('PI','PE')
and B1_AGREGCU = '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'ME_GD' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'ME'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all
SELECT 'ME_WIP' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'ME'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL = '99'
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'ME_TER' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'ME'
and B1_AGREGCU = '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'PA_GD' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'PA'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'PA_WIP' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'PA'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL = '99'
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all

SELECT 'PA_TER' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'PA'
and B1_AGREGCU ='1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all


SELECT 'MM_GD' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MM'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all

SELECT 'MM_WIP' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MM'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL = '99'
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all

SELECT 'MM_TER' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MM'
and B1_AGREGCU = '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')



GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all

SELECT  
'SV_GD' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial--, 0 as MP_PROD, 0 as MPTER
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'SV'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all
SELECT  
'SV_WIP' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial--, 0 as MPTER
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'SV'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL = '99'
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')


GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all

SELECT  
'SV_TER' as DESCRICAO, ISNULL(SUM(D2_CUSTO1),0) as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'SV'
and B1_AGREGCU = '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL   union all

SELECT  
'MC_GD' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial--, 0 as MP_PROD, 0 as MPTER
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MC'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')

GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all
SELECT  
'MC_WIP' as DESCRICAO,ISNULL(SUM(D2_CUSTO1),0)as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial--, 0 as MPTER
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MC'
and B1_AGREGCU <> '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL = '99'
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')


GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL union all

SELECT  
'MC_TER' as DESCRICAO, ISNULL(SUM(D2_CUSTO1),0) as valor,B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6) AS PERIODO, D2_FILIAL AS Filial
FROM SD2010
INNER JOIN SB1010 AS SB1 ON B1_COD = D2_COD
AND SD2010.D_E_L_E_T_  =''
AND B1_TIPO = 'MC'
and B1_AGREGCU = '1'
AND SB1.D_E_L_E_T_ = ''
JOIN SF4010 AS SF4 ON F4_CODIGO = D2_TES
AND F4_ESTOQUE = 'S' 

AND F4_PODER3 = 'N'
WHERE D2_FILIAL IN( '01','06')
AND SD2010.D_E_L_E_T_ = ''
AND D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND D2_EMISSAO >= '20140301' AND D2_TES NOT IN (SELECT F4_CODIGO  FROM SF4010 WHERE UPPER(F4_TEXTO) LIKE '%DEV%' OR UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
GROUP BY B1_COD,B1_CODANT,B1_DESC,B1_GRUPO,D2_PEDIDO,LEFT(D2_EMISSAO,6),D2_FILIAL
GO

