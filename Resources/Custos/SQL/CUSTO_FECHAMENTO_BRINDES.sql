/*    ==Scripting Parameters==

    Source Server Version : SQL Server 2014 (12.0.5207)
    Source Database Engine Edition : Microsoft SQL Server Standard Edition
    Source Database Engine Type : Standalone SQL Server

    Target Server Version : SQL Server 2014
    Target Database Engine Edition : Microsoft SQL Server Standard Edition
    Target Database Engine Type : Standalone SQL Server
*/

USE [Dadosadv_D1]
GO

/****** Object:  View [dbo].[CUSTO_FECHAMENTO_BRINDES]    Script Date: 02/11/2017 05:54:28 ******/
SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO



CREATE VIEW [dbo].[CUSTO_FECHAMENTO_BRINDES]
AS
SELECT 'MP_GD'		AS DESCRICAO
		,B1_COD		AS CODIGO 
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''		
					
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_ = ''		
AND		SD2.D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO >= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO = 'MP'
AND		SB1.B1_AGREGCU <> '1'
AND		SF4.F4_ESTOQUE = 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'MP_WIP'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	='99'
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'MP'
AND		SB1.B1_AGREGCU	<> '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


UNION ALL

SELECT 'MP_TER'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'MP'
AND		SB1.B1_AGREGCU	= '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'EB_GD'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_ = ''		
AND		SD2.D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO >= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO = 'EB'
AND		SB1.B1_AGREGCU <> '1'
AND		SF4.F4_ESTOQUE = 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'EB_WIP'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	='99'
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'EB'
AND		SB1.B1_AGREGCU	<> '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


UNION ALL

SELECT 'EB_TER'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'EB'
AND		SB1.B1_AGREGCU	= '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'MX_GD'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_ = ''		
AND		SD2.D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO >= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO = 'MX'
AND		SB1.B1_AGREGCU <> '1'
AND		SF4.F4_ESTOQUE = 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'MX_WIP'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	='99'
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'MX'
AND		SB1.B1_AGREGCU	<> '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


UNION ALL

SELECT 'MX_TER'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'MX'
AND		SB1.B1_AGREGCU	= '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'PI_SEMI'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_ = ''		
AND		SD2.D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO >= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO = 'PI'
AND		SB1.B1_AGREGCU <> '1'
AND		SF4.F4_ESTOQUE = 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'PI_WIP'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	='99'
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'PI'
AND		SB1.B1_AGREGCU	<> '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


UNION ALL

SELECT 'PI_TER'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'PI'
AND		SB1.B1_AGREGCU	= '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'ME_GD'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_ = ''		
AND		SD2.D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO >= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO = 'ME'
AND		SB1.B1_AGREGCU <> '1'
AND		SF4.F4_ESTOQUE = 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'ME_WIP'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	='99'
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'ME'
AND		SB1.B1_AGREGCU	<> '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


UNION ALL

SELECT 'ME_TER'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'ME'
AND		SB1.B1_AGREGCU	= '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL


SELECT 'PA_GD'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_ = ''		
AND		SD2.D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO >= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO = 'PA'
AND		SB1.B1_AGREGCU <> '1'
AND		SF4.F4_ESTOQUE = 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'PA_WIP'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	='99'
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'PA'
AND		SB1.B1_AGREGCU	<> '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


UNION ALL

SELECT 'PA_TER'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'PA'
AND		SB1.B1_AGREGCU	= '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'MM_GD'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_ = ''		
AND		SD2.D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO >= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO = 'MM'
AND		SB1.B1_AGREGCU <> '1'
AND		SF4.F4_ESTOQUE = 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'MM_WIP'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	='99'
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'MM'
AND		SB1.B1_AGREGCU	<> '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


UNION ALL

SELECT 'MM_TER'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'MM'
AND		SB1.B1_AGREGCU	= '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL


SELECT 'SV_GD'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_ = ''		
AND		SD2.D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO >= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO = 'SV'
AND		SB1.B1_AGREGCU <> '1'
AND		SF4.F4_ESTOQUE = 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'SV_WIP'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	='99'
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'SV'
AND		SB1.B1_AGREGCU	<> '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


UNION ALL

SELECT 'SV_TER'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'SV'
AND		SB1.B1_AGREGCU	= '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL


SELECT 'MC_GD'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_ = ''		
AND		SD2.D2_LOCAL NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO >= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO = 'MC'
AND		SB1.B1_AGREGCU <> '1'
AND		SF4.F4_ESTOQUE = 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL

UNION ALL

SELECT 'MC_WIP'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	='99'
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'MC'
AND		SB1.B1_AGREGCU	<> '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


UNION ALL

SELECT 'MC_TER'		AS DESCRICAO
		,B1_COD		AS CODIGO
		,B1_DESC	AS PRODUTO
		,B1_GRUPO	AS GRUPO
		,D2_TES		AS TES
		,D2_DOC		AS NUM_NF
		,D2_SERIE	AS SERIE_NF
		,D2_CLIENTE	AS [CLIENTE]
		,A1_NREDUZ	AS [APELIDO]		
		,LEFT(D2_EMISSAO,6) AS PERIODO
		,ISNULL(SUM(D2_CUSTO1),0) as VALOR , D2_FILIAL AS Filial
FROM SD2010 AS SD2
JOIN SF4010 AS SF4	ON	SF4.F4_FILIAL	= ''
					AND	SF4.F4_CODIGO	= D2_TES
					AND SF4.D_E_L_E_T_	= ''
JOIN SB1010 AS SB1	ON	SB1.B1_FILIAL	= '  '
					AND	SB1.B1_COD		= SD2.D2_COD
					AND	SB1.D_E_L_E_T_	= ''
JOIN SA1010 AS SA1  WITH (NOLOCK) 
		ON SA1.A1_FILIAL = ''
		AND SA1.A1_COD	= D2_CLIENTE
		AND SA1.A1_LOJA = D2_LOJA
		AND SA1.D_E_L_E_T_ = ''							
WHERE	SD2.D2_FILIAL IN('01','06')
AND		SD2.D_E_L_E_T_	= ''		
AND		SD2.D2_LOCAL	NOT IN ('99','3','4','5','6','7','8','9','0,','00','0','1','11','14','13','15','16','17','18','19','22','25','28','29','30','31','32','37','39','40','44','47','52','54','57','58','60','65','66','71','74','78','87','88','89','0.','8Q','O','OK','OP','TA','VC','  ')
AND		SD2.D2_EMISSAO	>= '20140301'				
AND		SD2.D2_TES IN (SELECT F4_CODIGO  FROM SF4010 WHERE F4_FILIAL	= '' AND UPPER(F4_TEXTO) LIKE '%BRINDE%' AND D_E_L_E_T_= '')
AND		SB1.B1_TIPO		= 'MC'
AND		SB1.B1_AGREGCU	= '1'
AND		SF4.F4_ESTOQUE	= 'S' 
GROUP BY B1_COD,B1_DESC,B1_GRUPO,D2_TES,D2_DOC,D2_SERIE,D2_CLIENTE,A1_NREDUZ,LEFT(D2_EMISSAO,6),D2_FILIAL


GO

